{% extends "base.html" %}

{% block title %}Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„</h2>
        <p class="text-muted">Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØµØ§ÙÙŠØ©</p>
    </div>
</div>

<!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div class="row mb-4">
    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
    <div class="col-md-4 mb-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title">ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h5>
                <h3>${{ "%.2f"|format(revenue_usd) }}</h3>
                <p class="mb-0">{{ "%.0f"|format(revenue_lbp) }} Ù„.Ù„</p>
                <small>{{ revenues|length }} Ù…Ø¹Ø§Ù…Ù„Ø©</small>
            </div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª -->
    <div class="col-md-4 mb-3">
        <div class="card bg-danger text-white">
            <div class="card-body">
                <h5 class="card-title">ğŸ’¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h5>
                <h3>${{ "%.2f"|format(expenses_usd) }}</h3>
                <p class="mb-0">{{ "%.0f"|format(expenses_lbp) }} Ù„.Ù„</p>
                <small>{{ expenses|length }} Ù…Ø¹Ø§Ù…Ù„Ø©</small>
            </div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØµØ§ÙÙŠØ© -->
    <div class="col-md-4 mb-3">
        <div class="card {% if net_usd >= 0 %}bg-info{% else %}bg-warning{% endif %} text-white">
            <div class="card-body">
                <h5 class="card-title">ğŸ“ˆ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØµØ§ÙÙŠØ©</h5>
                <h3>{% if net_usd >= 0 %}+{% endif %}${{ "%.2f"|format(net_usd) }}</h3>
                <p class="mb-0">{% if net_lbp >= 0 %}+{% endif %}{{ "%.0f"|format(net_lbp) }} Ù„.Ù„</p>
                <small>{% if net_usd >= 0 %}Ø±Ø¨Ø­ âœ…{% else %}Ø®Ø³Ø§Ø±Ø© âŒ{% endif %}</small>
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© -->
{% if revenue_by_category %}
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">ğŸ“Š Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº ($)</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ù„.Ù„)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, amounts in revenue_by_category.items() %}
                        <tr>
                            <td><strong>{{ category }}</strong></td>
                            <td>${{ "%.2f"|format(amounts.usd) }}</td>
                            <td>{{ "%.0f"|format(amounts.lbp) }} Ù„.Ù„</td>
                        </tr>
                        {% endfor %}
                        <tr class="table-success">
                            <td><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</strong></td>
                            <td><strong>${{ "%.2f"|format(revenue_usd) }}</strong></td>
                            <td><strong>{{ "%.0f"|format(revenue_lbp) }} Ù„.Ù„</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø© -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ“Š Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ÙØ¦Ø©</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº ($)</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ù„.Ù„)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, amounts in expense_by_category.items() %}
                        <tr>
                            <td><strong>{{ category }}</strong></td>
                            <td>${{ "%.2f"|format(amounts.usd) }}</td>
                            <td>{{ "%.0f"|format(amounts.lbp) }} Ù„.Ù„</td>
                        </tr>
                        {% endfor %}
                        <tr class="table-danger">
                            <td><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</strong></td>
                            <td><strong>${{ "%.2f"|format(expenses_usd) }}</strong></td>
                            <td><strong>{{ "%.0f"|format(expenses_lbp) }} Ù„.Ù„</strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Ø¬Ø¯ÙˆÙ„ ØªÙØµÙŠÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">ğŸ“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…ÙØµÙ„Ø©</h5>
            </div>
            <div class="card-body">
                {% if accounting %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„ÙØ¦Ø©</th>
                                <th>Ø§Ù„ÙˆØµÙ</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº ($)</th>
                                <th>Ø§Ù„Ù…Ø¨Ù„Øº (Ù„.Ù„)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in accounting | sort(attribute='date', reverse=True) %}
                            <tr>
                                <td>{{ transaction.date.strftime('%Y-%m-%d') }}</td>
                                <td>
                                    {% if transaction.transaction_type == 'Ø¥ÙŠØ±Ø§Ø¯' %}
                                        <span class="badge bg-success">{{ transaction.transaction_type }}</span>
                                    {% else %}
                                        <span class="badge bg-danger">{{ transaction.transaction_type }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ transaction.category }}</strong>
                                </td>
                                <td>
                                    {% if transaction.description %}
                                        {{ transaction.description[:50] }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if transaction.transaction_type == 'Ø¥ÙŠØ±Ø§Ø¯' %}
                                        <span class="text-success"><strong>+${{ "%.2f"|format(transaction.amount_usd) }}</strong></span>
                                    {% else %}
                                        <span class="text-danger"><strong>-${{ "%.2f"|format(transaction.amount_usd) }}</strong></span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if transaction.transaction_type == 'Ø¥ÙŠØ±Ø§Ø¯' %}
                                        <span class="text-success"><strong>+{{ "%.0f"|format(transaction.amount_lbp) }} Ù„.Ù„</strong></span>
                                    {% else %}
                                        <span class="text-danger"><strong>-{{ "%.0f"|format(transaction.amount_lbp) }} Ù„.Ù„</strong></span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- Ø®Ø· Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
                <div class="mt-4">
                    <div class="alert {% if net_usd >= 0 %}alert-success{% else %}alert-warning{% endif %}" role="alert">
                        <h4 class="alert-heading">ğŸ’¡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</h4>
                        <hr>
                        <p class="mb-1"><strong>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</strong> ${{ "%.2f"|format(revenue_usd) }} | {{ "%.0f"|format(revenue_lbp) }} Ù„.Ù„</p>
                        <p class="mb-1"><strong>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</strong> ${{ "%.2f"|format(expenses_usd) }} | {{ "%.0f"|format(expenses_lbp) }} Ù„.Ù„</p>
                        <hr>
                        <p class="mb-0">
                            <strong>
                                {% if net_usd >= 0 %}
                                    âœ… ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: +${{ "%.2f"|format(net_usd) }} | +{{ "%.0f"|format(net_lbp) }} Ù„.Ù„
                                {% else %}
                                    âŒ ØµØ§ÙÙŠ Ø§Ù„Ø®Ø³Ø§Ø±Ø©: -${{ "%.2f"|format(net_usd|abs) }} | -{{ "%.0f"|format(net_lbp|abs) }} Ù„.Ù„
                                {% endif %}
                            </strong>
                        </p>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-info">
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø­Ø§Ø³Ø¨ÙŠØ© Ù…Ø³Ø¬Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ -->
<div class="row mt-4">
    <div class="col-md-12">
        <a href="{{ url_for('accounting.add_accounting') }}" class="btn btn-success me-2">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø©</a>
        <a href="{{ url_for('accounting.accounting_list') }}" class="btn btn-primary me-2">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</a>
        <a href="{{ url_for('reports.reports_list') }}" class="btn btn-secondary">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>
    </div>
</div>

{% endblock %}
